{"version":3,"file":"index.js","sources":["../index.ts"],"sourcesContent":["import {useState, useEffect} from 'react'\n\nexport interface DevicePixelRatioOptions {\n  /**\n   * Default DPR to use if browser does not support the `devicePixelRatio`\n   * property, or when rendering on server\n   *\n   * @defaultValue `1`\n   */\n  defaultDpr?: number\n\n  /**\n   * Whether or not to round the number down to the closest integer\n   *\n   * @defaultValue `true`\n   */\n  round?: boolean\n\n  /**\n   * Maximum DPR to return (set to `2` to only generate 1 and 2)\n   *\n   * @defaultValue `3`\n   */\n  maxDpr?: number\n}\n\n/**\n * Get the device pixel ratio, potentially rounded and capped.\n * Will emit new values if it changes.\n *\n * @param options\n * @returns The current device pixel ratio, or the default if none can be resolved\n */\nexport function useDevicePixelRatio(options?: DevicePixelRatioOptions) {\n  const dpr = getDevicePixelRatio(options)\n  const [currentDpr, setCurrentDpr] = useState(dpr)\n  const {defaultDpr, maxDpr, round} = options || {}\n\n  useEffect(() => {\n    const canListen = typeof window !== 'undefined' && 'matchMedia' in window\n    if (!canListen) {\n      return\n    }\n\n    const updateDpr = () => setCurrentDpr(getDevicePixelRatio({defaultDpr, maxDpr, round}))\n    const mediaMatcher = window.matchMedia(`screen and (resolution: ${currentDpr}dppx)`)\n\n    // Safari 13.1 does not have `addEventListener`, but does have `addListener`\n    if (mediaMatcher.addEventListener) {\n      mediaMatcher.addEventListener('change', updateDpr)\n    } else {\n      mediaMatcher.addListener(updateDpr)\n    }\n\n    return () => {\n      if (mediaMatcher.removeEventListener) {\n        mediaMatcher.removeEventListener('change', updateDpr)\n      } else {\n        mediaMatcher.removeListener(updateDpr)\n      }\n    }\n  }, [currentDpr, defaultDpr, maxDpr, round])\n\n  return currentDpr\n}\n\n/**\n * Returns the current device pixel ratio (DPR) given the passed options\n *\n * @param options\n * @returns current device pixel ratio\n */\nexport function getDevicePixelRatio(options?: DevicePixelRatioOptions): number {\n  const {defaultDpr = 1, maxDpr = 3, round = true} = options || {}\n  const hasDprProp = typeof window !== 'undefined' && typeof window.devicePixelRatio === 'number'\n  const dpr = hasDprProp ? window.devicePixelRatio : defaultDpr\n  const rounded = Math.min(Math.max(1, round ? Math.floor(dpr) : dpr), maxDpr)\n  return rounded\n}\n"],"names":["useDevicePixelRatio","options","dpr","getDevicePixelRatio","currentDpr","setCurrentDpr","useState","defaultDpr","maxDpr","round","useEffect","canListen","window","updateDpr","mediaMatcher","matchMedia","addEventListener","addListener","removeEventListener","removeListener","hasDprProp","devicePixelRatio","rounded","Math","min","max","floor"],"mappings":";;AA0BA;;;;;;AAMG;;AACG,SAAUA,mBAAV,CAA8BC,OAA9B,EAA+D;AACnE,EAAA,MAAMC,GAAG,GAAGC,mBAAmB,CAACF,OAAD,CAA/B,CAAA;AACA,EAAM,MAAA,CAACG,UAAD,EAAaC,aAAb,IAA8BC,cAAQ,CAACJ,GAAD,CAA5C,CAAA;AACA,EAAM,MAAA;AAACK,IAAAA,UAAD;AAAaC,IAAAA,MAAb;AAAqBC,IAAAA,KAAAA;AAArB,GAA8BR,GAAAA,OAAO,IAAI,EAA/C,CAAA;AAEAS,EAAAA,eAAS,CAAC,MAAK;AACb,IAAMC,MAAAA,SAAS,GAAG,OAAOC,MAAP,KAAkB,WAAlB,IAAiC,gBAAgBA,MAAnE,CAAA;;AACA,IAAI,IAAA,CAACD,SAAL,EAAgB;AACd,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,MAAME,SAAS,GAAG,MAAMR,aAAa,CAACF,mBAAmB,CAAC;AAACI,MAAAA,UAAD;AAAaC,MAAAA,MAAb;AAAqBC,MAAAA,KAAAA;AAArB,KAAD,CAApB,CAArC,CAAA;;AACA,IAAMK,MAAAA,YAAY,GAAGF,MAAM,CAACG,UAAP,CAA6C,CAAA,wBAAA,EAAAX,UAAiB,CAAA,KAAA,CAA9D,CAArB,CAPa;;AAUb,IAAIU,IAAAA,YAAY,CAACE,gBAAjB,EAAmC;AACjCF,MAAAA,YAAY,CAACE,gBAAb,CAA8B,QAA9B,EAAwCH,SAAxC,CAAA,CAAA;AACD,KAFD,MAEO;AACLC,MAAAA,YAAY,CAACG,WAAb,CAAyBJ,SAAzB,CAAA,CAAA;AACD,KAAA;;AAED,IAAA,OAAO,MAAK;AACV,MAAIC,IAAAA,YAAY,CAACI,mBAAjB,EAAsC;AACpCJ,QAAAA,YAAY,CAACI,mBAAb,CAAiC,QAAjC,EAA2CL,SAA3C,CAAA,CAAA;AACD,OAFD,MAEO;AACLC,QAAAA,YAAY,CAACK,cAAb,CAA4BN,SAA5B,CAAA,CAAA;AACD,OAAA;AACF,KAND,CAAA;AAOD,GAvBQ,EAuBN,CAACT,UAAD,EAAaG,UAAb,EAAyBC,MAAzB,EAAiCC,KAAjC,CAvBM,CAAT,CAAA;AAyBA,EAAA,OAAOL,UAAP,CAAA;AACD,CAAA;AAED;;;;;AAKG;;AACG,SAAUD,mBAAV,CAA8BF,OAA9B,EAA+D;AACnE,EAAM,MAAA;AAACM,IAAAA,UAAU,GAAG,CAAd;AAAiBC,IAAAA,MAAM,GAAG,CAA1B;AAA6BC,IAAAA,KAAK,GAAG,IAAA;AAArC,GAA6CR,GAAAA,OAAO,IAAI,EAA9D,CAAA;AACA,EAAA,MAAMmB,UAAU,GAAG,OAAOR,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACS,gBAAd,KAAmC,QAAvF,CAAA;AACA,EAAMnB,MAAAA,GAAG,GAAGkB,UAAU,GAAGR,MAAM,CAACS,gBAAV,GAA6Bd,UAAnD,CAAA;AACA,EAAMe,MAAAA,OAAO,GAAGC,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,GAAL,CAAS,CAAT,EAAYhB,KAAK,GAAGc,IAAI,CAACG,KAAL,CAAWxB,GAAX,CAAH,GAAqBA,GAAtC,CAAT,EAAqDM,MAArD,CAAhB,CAAA;AACA,EAAA,OAAOc,OAAP,CAAA;AACD;;;;;"}